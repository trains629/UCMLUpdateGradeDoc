# 系统自动升级安装包工具使用手册

整个文档分成两部分，第一部分为安装包配置工具的使用，介绍各个操作菜单及功能的使用方法；
第二部分为自动升级工具的功能介绍和使用方法说明。

## 1 系统自动升级安装包配置工具使用

### 1.1 配置工具使用
配置工具的主界面见下图，
![][0.2]  
在这里我们可以进行数据表更新，BPO备份，代码表信息导出，屏幕定义信息导出，工作流导出，
报表定义信息导出，业务定义信息导出，资源文件升级等功能。后面章节分别介绍各个功能的操作过程。  
程序启动后默认显示`通用设置`页，此页会显示出当前平台的源代码目录。


### 1.1.2 文件
此处为系统功能，包含新建，关闭，创建升级包，关闭等功能。
![][file]  

#### 1.1.2.1 新建
清除掉当前的全部设置内容，并建立一个空的项目对象，此状态和程序第一次
启动效果相同。

#### 1.1.2.2 保存
程序默认不会各种设置和修改进行保存，只有点击`保存`菜单，才会将设置修改进行保存。

#### 1.1.2.3 创建升级包
点击`创建升级包`按键，将弹出生成升级包界面,  
![][11.1]  
在这里设置升级包输出目录，查看生成进度。默认将升级安装包输出到平台安装目录下，
点击`...`弹出文件保存选择框设置升级包的保存位置和名称。  
点击`生成`，开始生成生成升级包，  
![][11.2]  
生成完成  
![][11.3]  

#### 1.1.2.4 退出
结束当前工具，不会保存任何设置修改。

### 1.1.3 环境数据到目标库
在主界面上可以看到`环境数据到目标库`菜单。  
![][menu]
这里的功能包括：
1. 代码表信息导出
2. 屏幕定义信息
3. 工作流定义信息
4. 报表定义信息
5. 业务定义信息
6. 业务单元权限定义信息
7. 可动态装配组件

#### 1.1.3.1 代码表信息导出
在`环境库到目标库`菜单中选择`代码表(枚举值)信息`子菜单。  
![][3.1]  
会弹出代码表选择界面:  
![][3.2]  
在这里列出当前平台可以用于导出的代码表，根据实际需要选择相应的代码表。  在这个界面中，我们可以通过`全部`,`选中`,`未选中`几个状态去查看我们的选择情况，另外还支持按标识名称进行筛选。选中`按标识筛选`,在关键字后面的输入框内输入需要筛选的内容，点击`筛选`按键进行筛选，效果见下图。
![][3.4]  
在我们选择完需要的代码表后，点击`保存`按键去更新对代码表的选择。
![][3.3]
程序会自动切换到主界面下代码表所对应的标签页，便于我们查看所选中的代码表信息。

#### 1.1.3.2 屏幕定义信息
在`环境库到目标库`菜单中选择`屏幕定义信息`子菜单。会弹出屏幕定义选择界面，
![][4.1]  
在这里列出当前平台可以用于导出的`屏幕定义信息`，根据实际需要选择相应的`屏幕定义信息`。
在我们选择完需要的`屏幕定义信息`后，点击`保存`按键去更新对`屏幕定义信息`的选择。
![][4.2]  
程序会自动切换到主界面下`屏幕定义信息`所对应的标签页，便于我们查看所选中的屏幕定义信息。

#### 1.1.3.3 工作流定义信息
在`环境库到目标库`菜单中选择`工作流定义信息`子菜单。会弹出工作流定义信息选择界面，
![][5.1]  
在这里列出当前平台可以用于导出的`工作流定义信息`，根据实际需要选择相应的`工作流定义信息`。
在我们选择完需要的`工作流定义信息`后，点击`保存`按键去更新对`工作流定义信息`的选择。
![][5.2]  
程序会自动切换到主界面下`工作流定义信息`所对应的标签页，便于我们查看所选中的工作流定义信息。

#### 1.1.3.4 报表定义信息
在`环境库到目标库`菜单中选择`报表定义信息`子菜单。会弹出报表定义信息选择界面，
![][6.1]  
在这里列出当前平台可以用于导出的`报表定义信息`，根据实际需要选择相应的`报表定义信息`。
在我们选择完需要的`报表定义信息`后，点击`保存`按键去更新对`报表定义信息`的选择。
![][6.2]  
程序会自动切换到主界面下`报表定义信息`所对应的标签页，便于我们查看所选中的报表定义信息。

#### 1.1.3.5 业务定义信息
在`环境库到目标库`菜单中选择`业务定义信息`子菜单。会弹出业务定义信息选择界面，
![][7.1]  
在这里列出当前平台可以用于导出的`业务定义信息`，根据实际需要选择相应的`业务定义信息`。
在我们选择完需要的`业务定义信息`后，点击`保存`按键去更新对`业务定义信息`的选择。
![][7.2]  
程序会自动切换到主界面下`业务定义信息`所对应的标签页，便于我们查看所选中的业务定义信息。

#### 1.1.3.6 业务单元权限定义信息
在`环境库到目标库`菜单中选择`业务单元权限定义信息`子菜单。会弹出业务单元权限定义信息选择界面，
![][7.1]  
在这里列出当前平台可以用于导出的`业务单元权限定义信息`，根据实际需要选择相应的`业务单元权限定义信息`。
在我们选择完需要的`业务单元权限定义信息`后，点击`保存`按键去更新对`业务单元权限定义信息`的选择。
![][7.2]  
程序会自动切换到主界面下`业务单元权限定义信息`所对应的标签页，便于我们查看所选中的业务单元权限定义信息。

#### 1.1.3.7 可动态装配组件
在`环境库到目标库`菜单中选择`可动态装配组件`子菜单。会弹出可动态装配组件选择界面，
![][7.1]  
在这里列出当前平台可以用于导出的`可动态装配组件`，根据实际需要选择相应的`可动态装配组件`。
在我们选择完需要的`可动态装配组件`后，点击`保存`按键去更新对`可动态装配组件`的选择。
![][7.2]  
程序会自动切换到主界面下`可动态装配组件`所对应的标签页，便于我们查看所选中的可动态装配组件。


### 1.1.4 资源
在主界面上可以看到`资源`菜单。这里的功能包括：  
1. 选择需要更新的数据表  
2. 选择需要备份的BPO  
3. 选择需要升级的文件

#### 1.1.4.1 选择需要更新的数据表
在`资源`菜单中选择`选择需要更新的数据表`子菜单。会弹出数据表选择界面,  
![][10.2]  
在这里选择需要更新的数据表，点击`保存`按键更新选择。程序会自动切换到主界面下`数据表`所对应的标签页，
便于我们查看以及设置数据表。  
![][10.3]  
这里我们可以有两种方式去更新目标库的数据表结果：
1. 修改现有数据表模式
  此模式下用户可以在`升级语句`对应的输入框内输入相应的SQL语句,自动升级工具
  会按这些输入去执行相关的更新。
2. 新建数据表模式
  此模式无需用户手动输入，当升级模式切换到此模式时，平台会自动生成相应的
  升级SQL语句。  
两种模式的切换可以通过点击`升级模式`下的对应项。
如果需要记录当前表升级内容或目的，可以将这些内容写在`升级描述`里。
当完成对指定数据表的设置之后，点击`保存`按键进行更新。

#### 1.1.4.2 选择需要备份的BPO
在`资源`菜单中选择`选择需要备份的BPO`子菜单。会弹出`选择BPO`界面，
![][2.1]  
在这里列出当前平台可供选择的BPO，根据实际需要选择相应的BPO。在我们选择完后，点击`保存`按键更新对BPO的选择。
![][2.2]  
程序会自动切换到主界面下`源码导出`所对应的标签页，便于我们查看所选中的BPO。

#### 1.1.4.3 选择需要升级的文件
在`资源`菜单中选择`选择需要升级的文件`子菜单。程序会自动切换到主界面下`资源文件`所对应
的标签页，这个页面添加需要在`项目源码`中增加的文件或目录。
![][1.1]  
点击指定的目录节点，点击鼠标右键，将弹出添加菜单。  
![][1.2]  
有四个选项：
1. 插入
  用于插入一个目录，点击菜单会弹出目录名称设置界面,    
  ![][1.3]  
  点击`OK`会在目录树中创建一个目录节点，在升级过程中，会按输入的名称创建指定目录。
  此目录节点一经创建不能修改名称。
2. 选择文件
  用于添加一个指定文件。点击菜单后会弹出文件选择界面,  
  ![][1.4]  
  选择指定文件文件后，会弹出一个文件名输入框，  
  ![][1.5]  
  默认为选中的文件名，如果使用其他名字可以在此进行修改，一经确定文件名不可进行修改！
3. 选择目录
  用于添加一个指定目录。点击菜单后会弹出`浏览文件夹`界面，
  ![][1.6]  
  选择对应文件夹后，会弹出一个目录名称设定界面，  
  ![][1.7]  
4. 删除
  删除目录树上的指定节点  

通过上面菜单完成更新文件目录的选择之后会看到如下,  
![][1.8]  
在自动升级工具运行的时候会按上图的结构对目标源码目录进行增量升级。

### 1.2 自动升级安装包制作
在平台中点击`制作系统自动升级安装包`菜单来启动配置工具。  
![][0.1]  
程序启动后，参照前面章节按需要在各个标签页下进行相应内容进行设置。
待设置完成后，执行`创建升级包`生成升级包。  
![][11.4]
此安装包可以脱离平台环境使用，当我们有多台服务器需要升级时，
只需将生成的安装包拷贝到目标服务器上运行即可。

## 2 自动升级工具使用
运行我们得到的升级包，可以看到下图界面，  
![][update]  

### 2.1 功能区域说明
此工具包含以下几个部分：
1. 源代码输出目录
  在此处设置目标源码的根目录，例如`D:\CaseLib_WX\BPObject`，
  其中目录BPObject包含平台生成的源代码，这里把`D:\CaseLib_WX`作为源码根目录。
2. 数据库连接
  在这里配置数据库连接信息，包括用户名，密码，服务器地址，数据库名称等
3. 数据表信息
  此部分是用来查看都有哪些数据表需要升级以及相应描述。
4. 日志输出区域  
  此部分用于显示执行过程的日志输出，方便了解升级包执行情况。

### 2.2 使用过程
1. 双击生成的升级安装包  
![][11.4]
2. 待程序启动后，设置源代码输出目录。
3. 设置数据库连接信息，填写用户名，密码，服务器地址，数据库名称等。
4. 点击`升级`按键，执行升级操作。
5. 程序自动执行升级操作。
6. 执行完成后会有成功提示，若失败可以查看日志输出了解问题所在。


[update]: ./002.jpg "自动升级工具主界面"
[0.1]: ./001.png "启动配置工具"
[0.2]: ./003.png "系统自动升级安装包配置工具"
[1.1]: ./add01.png "配置资源文件"
[1.2]: ./add02.png "资源文件设置菜单"
[1.3]: ./add03.png "添加空目录"
[1.4]: ./add04_1.png "选择实际文件"
[1.5]: ./add04.png "设置需要显示的文件"
[1.6]: ./add05.png "选择实际目录"
[1.7]: ./add06.png "设置需要显示的目录名"
[1.8]: ./add07.jpg "完成设置"

[2.1]: ./BPO02.jpg "选择BPO"
[2.2]: ./BPO03.jpg "BPO选择结果浏览"

[3.1]: ./code01.png "选择代码表信息菜单"
[3.2]: ./code02.jpg "选择需要导出的代码表"
[3.3]: ./code03.jpg "代码表选择结果浏览"
[3.4]: ./code04.jpg "筛选"

[4.1]: ./screen01.png "屏幕定义信息选择"
[4.2]: ./screen02.png "屏幕定义信息浏览"

[5.1]: ./work01.png "工作流定义信息选择"
[5.2]: ./work02.png "工作流定义信息浏览"

[6.1]: ./report01.png "报表定义信息选择"
[6.2]: ./report02.png "报表定义信息浏览"

[7.1]: ./yw01.jpg "业务定义信息选择"
[7.2]: ./yw02.png "业务定义信息浏览"

[8.1]: ./power01.png "业务单元权限定义信息选择"
[8.2]: ./power02.png "业务单元权限定义信息浏览"

[9.1]: ./vc01.png "可动态装配组件选择"
[9.2]: ./vc02.png "可动态装配组件浏览"

[10.1]: ./table01.png "选择数据表"
[10.2]: ./table02.png "数据表选择"
[10.3]: ./table03.png "设置修改方式"

[file]: ./file.png "系统菜单"
[menu]: ./menu.png "环境数据到目标库菜单"
[11.1]: ./make01.png "生成升级安装包"
[11.2]: ./make02.png "生成进度"
[11.3]: ./make03.png "生成完成"
[11.4]: ./make04.png "升级包文件"
